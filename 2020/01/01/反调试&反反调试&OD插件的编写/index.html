<!DOCTYPE html>




<html class="theme-next pisces" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="windows异常分发回顾异常的分发一共有多少轮？一共有两轮。 KiDispatchExcption 函数的最后一个参数 FirstChance 表示当前是第几次进行异常的分发，另一个函数 RaiseException 最后一个参数也表示当前是第几次分发 通过什么可以区分当前所处的是 R0 还是 R3在 windows 下，代码被分为了 R3 和 R0 权限，CS 段寄存器的最低两位就表示当前所处">
<meta name="keywords" content="Kncoked">
<meta property="og:type" content="article">
<meta property="og:title" content="反调试&amp;反反调试&amp;OD插件的编写">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2020&#x2F;01&#x2F;01&#x2F;%E5%8F%8D%E8%B0%83%E8%AF%95&amp;%E5%8F%8D%E5%8F%8D%E8%B0%83%E8%AF%95&amp;OD%E6%8F%92%E4%BB%B6%E7%9A%84%E7%BC%96%E5%86%99&#x2F;index.html">
<meta property="og:site_name" content="Knocked_Blog">
<meta property="og:description" content="windows异常分发回顾异常的分发一共有多少轮？一共有两轮。 KiDispatchExcption 函数的最后一个参数 FirstChance 表示当前是第几次进行异常的分发，另一个函数 RaiseException 最后一个参数也表示当前是第几次分发 通过什么可以区分当前所处的是 R0 还是 R3在 windows 下，代码被分为了 R3 和 R0 权限，CS 段寄存器的最低两位就表示当前所处">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2020-01-01T12:50:25.045Z">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/01/01/反调试&反反调试&OD插件的编写/"/>





  <title>反调试&反反调试&OD插件的编写 | Knocked_Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Knocked_Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">HelloNewWorld</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/01/%E5%8F%8D%E8%B0%83%E8%AF%95&%E5%8F%8D%E5%8F%8D%E8%B0%83%E8%AF%95&OD%E6%8F%92%E4%BB%B6%E7%9A%84%E7%BC%96%E5%86%99/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kncoked">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Knocked_Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">反调试&反反调试&OD插件的编写</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-01T20:50:40+08:00">
                2020-01-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="windows异常分发回顾"><a href="#windows异常分发回顾" class="headerlink" title="windows异常分发回顾"></a>windows异常分发回顾</h1><h2 id="异常的分发一共有多少轮？"><a href="#异常的分发一共有多少轮？" class="headerlink" title="异常的分发一共有多少轮？"></a>异常的分发一共有多少轮？</h2><p>一共有两轮。 KiDispatchExcption 函数的最后一个参数 FirstChance 表示当前是第几次进行异常的分发，另一个函数 RaiseException 最后一个参数也表示当前是第几次分发</p>
<h2 id="通过什么可以区分当前所处的是-R0-还是-R3"><a href="#通过什么可以区分当前所处的是-R0-还是-R3" class="headerlink" title="通过什么可以区分当前所处的是 R0 还是 R3"></a>通过什么可以区分当前所处的是 R0 还是 R3</h2><p>在 windows 下，代码被分为了 R3 和 R0 权限，CS 段寄存器的最低两位就表示当前所处的是 3环(用户) 还是 0环(内核)，可以通过 mov eax, cs   +   test eax, 1 区分</p>
<h2 id="异常的产生方式有多少种"><a href="#异常的产生方式有多少种" class="headerlink" title="异常的产生方式有多少种"></a>异常的产生方式有多少种</h2><p>CPU 满足特定的条件之后，内部主动产生的异常，类似 int 3（IDT）</p>
<p>用户通过 RaiseException 构建 ExceptionRecord 主动抛出异常（KiDispatchException）</p>
<h2 id="编译器会为用户自定义的-try-except-添加怎样的异常处理函数"><a href="#编译器会为用户自定义的-try-except-添加怎样的异常处理函数" class="headerlink" title="编译器会为用户自定义的 __try __except 添加怎样的异常处理函数"></a>编译器会为用户自定义的 __try __except 添加怎样的异常处理函数</h2><p>在同一个函数内，无论用户编写了多少个 SEH，编译器只会安装一个 except_handler4</p>
<h2 id="当用户模式下产生异常时，SEH-函数会在什么时候被调用"><a href="#当用户模式下产生异常时，SEH-函数会在什么时候被调用" class="headerlink" title="当用户模式下产生异常时，SEH 函数会在什么时候被调用"></a>当用户模式下产生异常时，SEH 函数会在什么时候被调用</h2><p>int3 -&gt; idt(3) -&gt; _KiTrap03 -&gt; CommonDispatchException -&gt; KiDispatchExceptijon</p>
<p>-&gt; KeUserExceptionDispatcher(3) -&gt; RtlDispatchException(3) -&gt; RtlpExecuteHandlerForException(3) -&gt; except_handler4 -&gt; except_handler4_common</p>
<p>-&gt; 用户通过 _try _except 安装的异常处理函数</p>
<h2 id="在-R0-中异常是如何被传递给三环调试器的"><a href="#在-R0-中异常是如何被传递给三环调试器的" class="headerlink" title="在 R0 中异常是如何被传递给三环调试器的"></a>在 R0 中异常是如何被传递给三环调试器的</h2><p>DbgkForwardException -&gt; <strong>DbgkpSendApiMessage</strong> -&gt; 三环调试器</p>
<h2 id="R0-和-R3-的-RtlDispathException-有什么区别"><a href="#R0-和-R3-的-RtlDispathException-有什么区别" class="headerlink" title="R0 和 R3 的 RtlDispathException 有什么区别"></a>R0 和 R3 的 RtlDispathException 有什么区别</h2><p>KiDispatchException(0) -&gt; RtlDispathException(0) -&gt; SEH</p>
<p>KiUserExceptionDispatcher(3) -&gt; RtlDispathException(3) -&gt; VEH SEH UEF (VCH)</p>
<h1 id="反调试与反反调试"><a href="#反调试与反反调试" class="headerlink" title="反调试与反反调试"></a>反调试与反反调试</h1><p>反调试技术术语高级逆向分析技术范畴，并且涉及面异常广阔，几乎任何技术在经过精心的构造后都可以变成反调试技术</p>
<blockquote>
<p> 未公开的数据结构查询网站：<a href="https://www.vergiliusproject.com/" target="_blank" rel="noopener">https://www.vergiliusproject.com/</a></p>
</blockquote>
<ul>
<li>静态反调试：一般在调试开始时阻拦调试者，调试者只需要找到原因后可一次性突破</li>
<li>动态反调试：一般在调试过程中阻拦调试者，可在调试的过程中被频繁触发，因此需要调试者随时关注</li>
</ul>
<p>对于所有的用户层 PEB 静态反调试，可以在程序正式的运行之前先挂起用户程序，然后修改相应的字段为非调试模式，再继续执行</p>
<h2 id="BeginDebug"><a href="#BeginDebug" class="headerlink" title="BeginDebug"></a>BeginDebug</h2><p>BeginDebug: 调试标记位</p>
<p>当程序被调试的时候，BegingDebugged 字段保存的是1</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">__asm</span><br><span class="line">&#123;</span><br><span class="line">	; 通过 FS : [<span class="number">0x30</span>] 获取到 PEB 结构体的地址</span><br><span class="line">	mov eax, dword ptr fs:[<span class="number">0x30</span>]</span><br><span class="line"></span><br><span class="line">	; 通过 PEB 偏移为 <span class="number">0x02</span> 的地方获取到 BeingDebugged</span><br><span class="line">	movzx eax, <span class="keyword">byte</span> ptr [eax + <span class="number">0x02</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="IsDebuggerPresent"><a href="#IsDebuggerPresent" class="headerlink" title="IsDebuggerPresent"></a>IsDebuggerPresent</h2><p>IsDebuggerPresent：原理同上，检查 PEB.BeingDebugged 字段</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (IsDebuggerPresent())</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"调试状态\n"</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"非调试状态\n"</span>);</span><br></pre></td></tr></table></figure>

<h2 id="NTGlobalFlag"><a href="#NTGlobalFlag" class="headerlink" title="NTGlobalFlag"></a>NTGlobalFlag</h2><p>NTGlobalFlag：在当前进程处于调试状态时值为 0x70 ，可以通过判定此值来确定是否被调试</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> NtGlobalFlag = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">__asm</span><br><span class="line">&#123;</span><br><span class="line">	; 通过 TEB 偏移为 <span class="number">0x30</span> 找到 PEB 结构</span><br><span class="line">	mov eax, dword ptr fs : [<span class="number">0x30</span>]</span><br><span class="line"></span><br><span class="line">	; 通过 PEB 偏移为 <span class="number">0x68</span> 的地方找到 NtGlobalFlag</span><br><span class="line">	mov eax, dword ptr[eax + <span class="number">0x68</span>]</span><br><span class="line"></span><br><span class="line">	; 将结果保存到变量，目的是方便比较</span><br><span class="line">	mov NtGlobalFlag, eax</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> result = NtGlobalFlag == <span class="number">0x70</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>

<h2 id="HEAP"><a href="#HEAP" class="headerlink" title="_HEAP"></a>_HEAP</h2><p>_HEAP：没有被公开的结构体，不同版本的 NT 内核可能对这个结构体有不同的实现</p>
<p>ProcessHeap 的 Flags 与 ForceFlags 在正常情况下应为 2 与 0 ，处于调试状态时值会发生改变，此方法在 NT 5.X 版本以上无效</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> Flags = <span class="number">0</span>, ForceFlags = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">__asm</span><br><span class="line">&#123;</span><br><span class="line">	; 通过 fs : [<span class="number">0x30</span>] 可以找到 PEB 的地址</span><br><span class="line">	mov eax, dword ptr fs:[<span class="number">0x30</span>]</span><br><span class="line"></span><br><span class="line">	; 通过 PEB 偏移为 <span class="number">0x18</span> 的位置找到 ProcessHeap(_HEAP)</span><br><span class="line">	mov eax, dword ptr [eax + <span class="number">0x18</span>]</span><br><span class="line"></span><br><span class="line">	; 通过 _HEAP 偏移为 <span class="number">0x40</span> 和 <span class="number">0x44</span> 的字段找到两个标志</span><br><span class="line">	mov ecx, dword ptr [eax + <span class="number">0x40</span>]</span><br><span class="line">	mov Flags, ecx</span><br><span class="line">	mov ecx, dword ptr [eax + <span class="number">0x44</span>]</span><br><span class="line">	mov ForceFlags, ecx</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%08X %08X\n"</span>, Flags, ForceFlags);</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> result = (Flags != <span class="number">2</span> || ForceFlags != <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<h2 id="ProcessDebugPort"><a href="#ProcessDebugPort" class="headerlink" title="ProcessDebugPort"></a>ProcessDebugPort</h2><p>NTQueryInformationProcess() 是一个可以同时在 R0 及 R3 运行的函数，它的主要作用是查看进程相关的各种信息</p>
<p>根据想要查看的信息类别不同，我们给其第二个参数 ProcessInformationClass 传的值也就不同，根据 ProcessInformationClass 的类别可知，此函数可以查看大概60余种进程相关的信息</p>
<p>ProcessDebugPort 可以获取目标进程的调试端口，如果目标进程未处于调试状态，此端口为0，否则为0xFFFFFFFF</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 包含头文件</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;winternl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib,<span class="meta-string">"ntdll.lib"</span>)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> nDebugPort = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">NtQueryInformationProcess(</span><br><span class="line">	GetCurrentProcess(),   <span class="comment">// 目标进程句柄</span></span><br><span class="line">	ProcessDebugPort,      <span class="comment">// 查询信息类型</span></span><br><span class="line">	&amp;nDebugPort,           <span class="comment">// 输出查询信息</span></span><br><span class="line">	<span class="keyword">sizeof</span>(nDebugPort),    <span class="comment">// 查询类型大小</span></span><br><span class="line">	<span class="literal">NULL</span>);                 <span class="comment">// 实际返回数据大小</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> result = nDebugPort == <span class="number">0xFFFFFFFF</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>

<h2 id="ProcessDebugObjectHandle"><a href="#ProcessDebugObjectHandle" class="headerlink" title="ProcessDebugObjectHandle"></a>ProcessDebugObjectHandle</h2><p>ProcessDebugObjectHandle 可以获取目标进程的调试对象句柄，如果未处于调试状态则获取的值为 NULL，如果当前的程序被调试了，那么保存的就是非零值</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">HANDLE hProcessDebugObjectHandle = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">NtQueryInformationProcess(</span><br><span class="line">	GetCurrentProcess(),               <span class="comment">// 目标进程句柄</span></span><br><span class="line">	(PROCESSINFOCLASS)<span class="number">0x1E</span>,            <span class="comment">// 查询信息类型</span></span><br><span class="line">	&amp;hProcessDebugObjectHandle,        <span class="comment">// 输出查询信息</span></span><br><span class="line">	<span class="keyword">sizeof</span>(hProcessDebugObjectHandle), <span class="comment">// 查询类型大小</span></span><br><span class="line">	<span class="literal">NULL</span>);                             <span class="comment">// 实际返回大小</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> result = hProcessDebugObjectHandle ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>

<h2 id="ProcessDebugFlag"><a href="#ProcessDebugFlag" class="headerlink" title="ProcessDebugFlag"></a>ProcessDebugFlag</h2><p>ProcessDebugFlag 可以获取目标进程的调试标记，如果处于调试状态其值为1，否则为0</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">BOOL bProcessDebugFlag = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">NtQueryInformationProcess(</span><br><span class="line">	GetCurrentProcess(),       <span class="comment">// 目标进程句柄</span></span><br><span class="line">	(PROCESSINFOCLASS)<span class="number">0x1F</span>,    <span class="comment">// 查询信息类型</span></span><br><span class="line">	&amp;bProcessDebugFlag,        <span class="comment">// 输出查询信息</span></span><br><span class="line">	<span class="keyword">sizeof</span>(bProcessDebugFlag), <span class="comment">// 查询类型大小</span></span><br><span class="line">	<span class="literal">NULL</span>);                     <span class="comment">// 实际返回大小</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> result = bProcessDebugFlag ? <span class="literal">false</span> : <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>

<h2 id="ProcessBasicInformation"><a href="#ProcessBasicInformation" class="headerlink" title="ProcessBasicInformation"></a>ProcessBasicInformation</h2><p>ProcessBasicInformation 可以获取指定进程的父进程 PID ，我们可以将其与 Explorer.exe(资源管理器) 的PID进行对比，如果不匹配则证明此进程不是被双击运行的</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PROCESS_BASIC_INFORMATION</span> &#123;</span></span><br><span class="line">    ULONG ExitStatus;                   <span class="comment">// 进程返回码</span></span><br><span class="line">    PPEB  PebBaseAddress;               <span class="comment">// PEB地址</span></span><br><span class="line">    ULONG AffinityMask;                 <span class="comment">// CPU亲和性掩码</span></span><br><span class="line">    LONG  BasePriority;                 <span class="comment">// 基本优先级</span></span><br><span class="line">    ULONG UniqueProcessId;              <span class="comment">// 本进程PID</span></span><br><span class="line">    ULONG InheritedFromUniqueProcessId; <span class="comment">// 父进程PID</span></span><br><span class="line">&#125;stcProcInfo;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询到进程相关的基本信息，需要提供一个结构体进行接收</span></span><br><span class="line">NtQueryInformationProcess(GetCurrentProcess(), ProcessBasicInformation,</span><br><span class="line">    &amp;stcProcInfo, <span class="keyword">sizeof</span>(stcProcInfo), <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">DWORD ExplorerPID = <span class="number">0</span>;</span><br><span class="line">DWORD CurrentPID = stcProcInfo.InheritedFromUniqueProcessId;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以资源管理器的类名查询到资源管理所在的进程PID</span></span><br><span class="line">GetWindowThreadProcessId(FindWindow(<span class="string">L"Progman"</span>, <span class="literal">NULL</span>), &amp;ExplorerPID);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果相同就说明没有被调试</span></span><br><span class="line"><span class="keyword">bool</span> result = ExplorerPID == CurrentPID ? <span class="literal">false</span> : <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>

<h2 id="NtQuerySystemInformation"><a href="#NtQuerySystemInformation" class="headerlink" title="NtQuerySystemInformation"></a>NtQuerySystemInformation</h2><p>可以使用 NtQuerySystemInformation() 函数获取当前系统是否开启调试模式</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 保存了和系统调试相关的属性</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">SYSTEM_KERNEL_DEBUGGER_INFORMATION</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    BOOLEAN KernelDebuggerEnabled;</span><br><span class="line">    BOOLEAN KernelDebuggerNotPresent;</span><br><span class="line">&#125; DebuggerInfo = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询当前系统的调试情况</span></span><br><span class="line">NtQuerySystemInformation(</span><br><span class="line">    (SYSTEM_INFORMATION_CLASS)<span class="number">0x23</span>,       <span class="comment">// 查询信息类型</span></span><br><span class="line">    &amp;DebuggerInfo,                        <span class="comment">// 输出查询信息</span></span><br><span class="line">    <span class="keyword">sizeof</span>(DebuggerInfo),                 <span class="comment">// 查询类型大小</span></span><br><span class="line">    <span class="literal">NULL</span>);                                <span class="comment">// 实际返回大小</span></span><br><span class="line"><span class="keyword">return</span> DebuggerInfo.KernelDebuggerEnabled;</span><br></pre></td></tr></table></figure>

<h2 id="ZwSetInformationThread"><a href="#ZwSetInformationThread" class="headerlink" title="ZwSetInformationThread"></a>ZwSetInformationThread</h2><p>可以使用 ZwSetInformationThread() 函数主动脱离调试器，使自己与调试器的调试关系分离，进而达到反调试的目的</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> THREAD_INFO_CLASS &#123;</span><br><span class="line">    ThreadHideFromDebugger = <span class="number">17</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 一个未公开的函数，需要手动的使用 GetProcAddress 获取</span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">NTSTATUS</span><span class="params">(NTAPI* ZW_SET_INFORMATION_THREAD)</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    IN  HANDLE ThreadHandle,</span></span></span><br><span class="line"><span class="function"><span class="params">    IN  THREAD_INFO_CLASS ThreadInformaitonClass,</span></span></span><br><span class="line"><span class="function"><span class="params">    IN  PVOID ThreadInformation,</span></span></span><br><span class="line"><span class="function"><span class="params">    IN  ULONG ThreadInformationLength)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ZSIT_DetachDebug</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ZW_SET_INFORMATION_THREAD Func = (ZW_SET_INFORMATION_THREAD)</span><br><span class="line">        <span class="comment">// 加载了 ntdll 模块，因为函数保存在这个模块中</span></span><br><span class="line">        GetProcAddress(LoadLibrary(<span class="string">L"ntdll.dll"</span>), </span><br><span class="line">        <span class="comment">// 函数的名称</span></span><br><span class="line">        <span class="string">"ZwSetInformationThread"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对调试器隐藏当前的线程，原理上就是让 DbgkpSendApiMessage 函数</span></span><br><span class="line">    <span class="comment">//  不向建立了调试关系的调试器发送调试信息。</span></span><br><span class="line">    Func(GetCurrentThread(), ThreadHideFromDebugger, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="FindWindow"><a href="#FindWindow" class="headerlink" title="FindWindow"></a>FindWindow</h2><p>FindWindow() 函数查询窗口名</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (FindWindow(<span class="string">L"OllyDbg"</span>, <span class="literal">NULL</span>))</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"存在调试器\n"</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"没检测到调试器\n"</span>);</span><br></pre></td></tr></table></figure>



<h1 id="插件加载的原理"><a href="#插件加载的原理" class="headerlink" title="插件加载的原理"></a>插件加载的原理</h1><ul>
<li>应用程序如何找到自己的插件：</li>
</ul>
<p>所有支持插件的应用程序，都会存在一个插件路径，用户提供的就应该放置到这个路径底下，应用程序通过遍历文件的方式来确保能够找到插件。</p>
<ul>
<li>插件的存在形式是什么？</li>
</ul>
<p>插件的存在形式通常都是 dll 文件，这些文件可以是任何后缀名结尾的，并不影响插件本身的功能</p>
<ul>
<li>应用程序如何识别插件路径下的模块是否是插件？</li>
</ul>
<p>一个合格的插件，应该能够提供相应的导出函数说明当前插件的名称，版本以及能够支持的应用程序。</p>
<ul>
<li>插件是如何提供功能的？</li>
</ul>
<p>通过实现指定的导出函数可以提供相应的功能。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个函数指针的别名</span></span><br><span class="line"><span class="keyword">using</span> f_query = <span class="keyword">bool</span> (*)(<span class="keyword">int</span> v, <span class="keyword">char</span> name[<span class="number">20</span>], <span class="keyword">char</span> version[<span class="number">20</span>]);</span><br><span class="line"><span class="keyword">using</span> f_run = <span class="keyword">void</span> (*)();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用于保存插件信息的结构体</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">PLUGIN_INFO</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="keyword">char</span> name[<span class="number">20</span>];</span><br><span class="line">	<span class="keyword">char</span> version[<span class="number">20</span>];</span><br><span class="line">	HMODULE <span class="keyword">module</span>;</span><br><span class="line">&#125; PLUGIN_INFO, *PPLUGIN_INFO;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义容器用于保存所有的插件</span></span><br><span class="line"><span class="built_in">vector</span>&lt;PLUGIN_INFO&gt; plugins;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化函数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 保存找到的文件的信息</span></span><br><span class="line">	WIN32_FIND_DATAA FileInfo = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 1. 遍历当前的插件目录，搜索所有的模块</span></span><br><span class="line">	HANDLE FindHandle = FindFirstFileA(<span class="string">".\\plugin\\*.plugin"</span>, &amp;FileInfo);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2. 如果说第一个文件查找成功就继续查找下一个</span></span><br><span class="line">	<span class="keyword">if</span> (FindHandle != INVALID_HANDLE_VALUE)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">do</span> &#123;</span><br><span class="line">			<span class="comment">// 保存当前插件的信息</span></span><br><span class="line">			PLUGIN_INFO plugin_info = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 模块文件的路径</span></span><br><span class="line">			<span class="built_in">string</span> path = <span class="built_in">string</span>(<span class="string">".\\plugin\\"</span>) + FileInfo.cFileName;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 尝试使用 LoadLibrary 加载模块</span></span><br><span class="line">			plugin_info.<span class="keyword">module</span> = LoadLibraryA(path.c_str());</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 判断一下这是不是一个有效的模块</span></span><br><span class="line">			<span class="keyword">if</span> (plugin_info.<span class="keyword">module</span> != <span class="literal">NULL</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">// 判断当前有没有导出指定函数</span></span><br><span class="line">				f_query f = (f_query)GetProcAddress(plugin_info.<span class="keyword">module</span>, <span class="string">"query"</span>);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 如果函数获取成功，并且函数返回true就表示这是一个有效的插件</span></span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (f != <span class="literal">nullptr</span> &amp;&amp; f(<span class="number">1</span>, plugin_info.name, plugin_info.version))</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">"插件: [%s %s] 已经被加载了\n"</span>, </span><br><span class="line">						plugin_info.name, plugin_info.version);</span><br><span class="line"></span><br><span class="line">					plugins.push_back(plugin_info);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">while</span> (FindNextFileA(FindHandle, &amp;FileInfo));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行期间的函数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 可以遍历插件列表，调用其中约定好的函数</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span>&amp; p : plugins)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 获取函数，这个函数可以不提供</span></span><br><span class="line">		f_run f = (f_run)GetProcAddress(p.<span class="keyword">module</span>, <span class="string">"run"</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (f) f();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 清理资源的函数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">release</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 一般会在 release 调用插件的清理函数</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span>&amp; p : plugins)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 获取函数，这个函数可以不提供</span></span><br><span class="line">		f_run f = (f_run)GetProcAddress(p.<span class="keyword">module</span>, <span class="string">"release"</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (f) f();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结束进程前调用的函数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">my_exit</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 程序结束前应该卸载插件</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; plugins.<span class="built_in">size</span>(); ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 将插件卸载(从内存空间移除)</span></span><br><span class="line">		<span class="comment">// 必须在卸载所有可能调用插件函数之后卸载插件</span></span><br><span class="line">		FreeLibrary(plugins[i].<span class="keyword">module</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 通常在程序运行的时候加载插件</span></span><br><span class="line">	init();</span><br><span class="line"></span><br><span class="line">	<span class="built_in">run</span>();</span><br><span class="line">    </span><br><span class="line">	<span class="built_in">release</span>();</span><br><span class="line">	my_exit();</span><br><span class="line"></span><br><span class="line"> 	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实例插件</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 插件导出一个约定好的函数，函数告诉了应用程序自己的名称版本等信息</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> __declspec(dllexport) <span class="function"><span class="keyword">bool</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">char</span> name[<span class="number">20</span>], <span class="keyword">char</span> version[<span class="number">20</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 参数一： 传入的参数，告诉插件自己的版本信息</span></span><br><span class="line">	<span class="comment">// 参数二： 传出的参数，告诉应用程序自己的名称</span></span><br><span class="line">	<span class="comment">// 参数三： 传出的参数，告诉应用程序自己的版本</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 如果目标应用不是 1.0 版本，该插件就不支持</span></span><br><span class="line">	<span class="keyword">if</span> (v != <span class="number">1</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">memcpy</span>(name, <span class="string">"plugin2"</span>, <span class="number">8</span>);</span><br><span class="line">	<span class="built_in">memcpy</span>(version, <span class="string">"2.0"</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> __declspec(dllexport) <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"这是插件提供的功能"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="OD插件的编写"><a href="#OD插件的编写" class="headerlink" title="OD插件的编写"></a>OD插件的编写</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Plugin/od_plugin.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib, <span class="meta-string">"Plugin/ollydbg.lib"</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;winternl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib,<span class="meta-string">"ntdll.lib"</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 包含头文件和链接LIB</span></span><br><span class="line"><span class="comment">// 2. 项目属性-&gt;C/C++-&gt;命令行选项 \J(使用无符号char)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PLUGINNAME <span class="meta-string">L"testplugin"</span>	<span class="comment">// 插件名称</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MY_VERSION <span class="meta-string">L"0.00.01"</span>       <span class="comment">// 插件版本</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建用于保存菜单的数组，菜单必须以一个全 0 结构结尾</span></span><br><span class="line">t_menu MainMenu[<span class="number">2</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">t_menu DasmMenu[<span class="number">2</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 必须导出的函数，用于提供插件的名字和版本号，并且检查是否符合要求</span></span><br><span class="line">extc <span class="keyword">int</span> __<span class="function">cdecl <span class="title">ODBG2_Pluginquery</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">int</span> ollydbgversion, </span></span></span><br><span class="line"><span class="function"><span class="params">	ulong *features,</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">wchar_t</span> pluginname[SHORTNAME], </span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">wchar_t</span> pluginversion[SHORTNAME])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 1. 检查OllyDBG的兼容版本</span></span><br><span class="line">	<span class="keyword">if</span> (ollydbgversion &lt; <span class="number">201</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2. 设置OllyDBG插件的名称与版本</span></span><br><span class="line">	wcscpy_s(pluginname, SHORTNAME, PLUGINNAME);	<span class="comment">// 设置插件名称</span></span><br><span class="line">	wcscpy_s(pluginversion, SHORTNAME, MY_VERSION); <span class="comment">// 设置插件版本</span></span><br><span class="line">	<span class="comment">// 3. 返回需要的API版本</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> PLUGIN_VERSION;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 菜单的回调函数，返回值是菜单的显示方式</span></span><br><span class="line"><span class="function"><span class="keyword">int</span>  <span class="title">MenuFunc</span><span class="params">(t_table *pt, <span class="keyword">wchar_t</span> *name, ulong index, <span class="keyword">int</span> mode)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 如果是第一次显示菜单，会是 MENU_VERIFY 方式</span></span><br><span class="line">	<span class="keyword">if</span> (mode == MENU_VERIFY)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (index == <span class="number">1</span>)</span><br><span class="line">			<span class="keyword">return</span> MENU_CHECKED | MENU_NORMAL;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			<span class="keyword">return</span> MENU_NORMAL;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (mode == MENU_EXECUTE)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (index == <span class="number">1</span>)</span><br><span class="line">			MessageBoxA(<span class="number">0</span>, <span class="string">"主菜单"</span>, <span class="string">"插件"</span>, MB_OK);</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			MessageBoxA(<span class="number">0</span>, <span class="string">"汇编菜单"</span>, <span class="string">"插件"</span>, MB_OK);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> MENU_NORMAL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 插件第二个被调用的函数，可以不被提供</span></span><br><span class="line">extc <span class="keyword">int</span> __<span class="function">cdecl <span class="title">ODBG2_Plugininit</span><span class="params">(<span class="keyword">void</span>)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 对插件的初始化操作</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置主菜单的信息</span></span><br><span class="line">	MainMenu[<span class="number">0</span>].index = <span class="number">1</span>;					<span class="comment">// 用于区分是哪一个菜单</span></span><br><span class="line">	MainMenu[<span class="number">0</span>].name = (WCHAR*)<span class="string">L"主菜单"</span>;		<span class="comment">// 菜单的名称</span></span><br><span class="line">	MainMenu[<span class="number">0</span>].help = (WCHAR*)<span class="string">L"主菜单"</span>;	<span class="comment">// 主菜单</span></span><br><span class="line">	MainMenu[<span class="number">0</span>].menufunc = MenuFunc;		<span class="comment">// 菜单的回调函数</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置汇编菜单的信息</span></span><br><span class="line">	DasmMenu[<span class="number">0</span>].index = <span class="number">2</span>;</span><br><span class="line">	DasmMenu[<span class="number">0</span>].name = (WCHAR*)<span class="string">L"汇编菜单"</span>;</span><br><span class="line">	DasmMenu[<span class="number">0</span>].help = (WCHAR*)<span class="string">L"汇编菜单"</span>;</span><br><span class="line">	DasmMenu[<span class="number">0</span>].menufunc = MenuFunc;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当有任何的菜单需要相应的时候，都会调用这个函数</span></span><br><span class="line">extc t_menu* __<span class="function">cdecl <span class="title">ODBG2_Pluginmenu</span><span class="params">(<span class="keyword">wchar_t</span> *type)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 1. 判断是否为主菜单弹出请求，是则弹出主菜单</span></span><br><span class="line">	<span class="keyword">if</span> (!wcscmp(type, PWM_MAIN))</span><br><span class="line">		<span class="keyword">return</span> MainMenu;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2. 判断是否为CPU窗口右键菜单弹出请求，是则弹出右键菜单</span></span><br><span class="line">	<span class="keyword">if</span> (!wcscmp(type, PWM_DISASM))</span><br><span class="line">		<span class="keyword">return</span> DasmMenu;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3. 返回空表示不设置菜单</span></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回不同时刻产生的重要的信息</span></span><br><span class="line">pentry(<span class="keyword">void</span>) ODBG2_Pluginnotify(<span class="keyword">int</span> code, <span class="keyword">void</span> *data, ulong parm1, ulong parm2)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 可以在这里进行反反调试</span></span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">int</span> First = TRUE;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 执行唯一的一次反调试</span></span><br><span class="line">	<span class="keyword">if</span> (code == PN_NEWPROC &amp;&amp; First)</span><br><span class="line">	&#123;</span><br><span class="line">		DWORD Size = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 获取进程的句柄</span></span><br><span class="line">		HANDLE Handle = OpenProcess(PROCESS_ALL_ACCESS, FALSE, parm1);</span><br><span class="line">	</span><br><span class="line">		<span class="comment">// 保存进程的基本信息</span></span><br><span class="line">		PROCESS_BASIC_INFORMATION Base = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 获取被调试进程PEB</span></span><br><span class="line">		NtQueryInformationProcess(Handle,</span><br><span class="line">			ProcessBasicInformation,</span><br><span class="line">			&amp;Base, <span class="keyword">sizeof</span>(Base), &amp;Size);</span><br><span class="line"></span><br><span class="line">		DWORD Peb = (DWORD)Base.PebBaseAddress;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 写入数据</span></span><br><span class="line">		WriteProcessMemory(Handle, (LPVOID)(Peb + <span class="number">2</span>),<span class="string">""</span>, <span class="number">1</span>, &amp;Size);</span><br><span class="line"></span><br><span class="line">		First = FALSE;</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>插件测试环境</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">链接: https://pan.baidu.com/s/1Ycgi-D8abbE6bvKanLIVQw 提取码: gphs</span><br></pre></td></tr></table></figure>


      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/01/01/windows%E5%BC%82%E5%B8%B8%E5%88%86%E5%8F%91/" rel="next" title="windows分发异常">
                <i class="fa fa-chevron-left"></i> windows分发异常
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Kncoked</p>
              <p class="site-description motion-element" itemprop="description">Knocked的个人博客</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">47</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">13</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">38</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#windows异常分发回顾"><span class="nav-number">1.</span> <span class="nav-text">windows异常分发回顾</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#异常的分发一共有多少轮？"><span class="nav-number">1.1.</span> <span class="nav-text">异常的分发一共有多少轮？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#通过什么可以区分当前所处的是-R0-还是-R3"><span class="nav-number">1.2.</span> <span class="nav-text">通过什么可以区分当前所处的是 R0 还是 R3</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#异常的产生方式有多少种"><span class="nav-number">1.3.</span> <span class="nav-text">异常的产生方式有多少种</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#编译器会为用户自定义的-try-except-添加怎样的异常处理函数"><span class="nav-number">1.4.</span> <span class="nav-text">编译器会为用户自定义的 __try __except 添加怎样的异常处理函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#当用户模式下产生异常时，SEH-函数会在什么时候被调用"><span class="nav-number">1.5.</span> <span class="nav-text">当用户模式下产生异常时，SEH 函数会在什么时候被调用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#在-R0-中异常是如何被传递给三环调试器的"><span class="nav-number">1.6.</span> <span class="nav-text">在 R0 中异常是如何被传递给三环调试器的</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#R0-和-R3-的-RtlDispathException-有什么区别"><span class="nav-number">1.7.</span> <span class="nav-text">R0 和 R3 的 RtlDispathException 有什么区别</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#反调试与反反调试"><span class="nav-number">2.</span> <span class="nav-text">反调试与反反调试</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#BeginDebug"><span class="nav-number">2.1.</span> <span class="nav-text">BeginDebug</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IsDebuggerPresent"><span class="nav-number">2.2.</span> <span class="nav-text">IsDebuggerPresent</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NTGlobalFlag"><span class="nav-number">2.3.</span> <span class="nav-text">NTGlobalFlag</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HEAP"><span class="nav-number">2.4.</span> <span class="nav-text">_HEAP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ProcessDebugPort"><span class="nav-number">2.5.</span> <span class="nav-text">ProcessDebugPort</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ProcessDebugObjectHandle"><span class="nav-number">2.6.</span> <span class="nav-text">ProcessDebugObjectHandle</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ProcessDebugFlag"><span class="nav-number">2.7.</span> <span class="nav-text">ProcessDebugFlag</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ProcessBasicInformation"><span class="nav-number">2.8.</span> <span class="nav-text">ProcessBasicInformation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NtQuerySystemInformation"><span class="nav-number">2.9.</span> <span class="nav-text">NtQuerySystemInformation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ZwSetInformationThread"><span class="nav-number">2.10.</span> <span class="nav-text">ZwSetInformationThread</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#FindWindow"><span class="nav-number">2.11.</span> <span class="nav-text">FindWindow</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#插件加载的原理"><span class="nav-number">3.</span> <span class="nav-text">插件加载的原理</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#OD插件的编写"><span class="nav-number">4.</span> <span class="nav-text">OD插件的编写</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Kncoked</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
